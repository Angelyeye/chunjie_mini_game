# 项目维护说明

本文件面向零基础维护者，说明项目结构、修改方式，以及如何添加/修改/删除角色、角色专属事件、通用事件。

## 一、项目结构（重要文件一览）

- 根目录 index.html：只是跳转页，会自动跳到 src/index.html
- src/index.html：主页面入口
- src/styles.css：样式
- src/game.js：核心逻辑（加载数据、渲染角色、事件、结局）
- data/characters.json：角色数据
- data/character_events.json：角色专属事件
- data/common_events.json：通用事件
- data/endings.json：结局数据
- images/：角色头像等图片资源
- .github/workflows/deploy.yml：GitHub Pages 自动部署配置

## 二、如何运行与修改

1. 用本地服务器打开项目（避免直接双击打开 HTML 造成数据加载失败）
   - macOS（Python）：在项目根目录打开终端，执行 `python3 -m http.server 8080`
   - macOS（Node.js）：在项目根目录打开终端，执行 `npx serve .`
   - Windows（PowerShell）：在项目根目录打开 PowerShell，执行 `python -m http.server 8080`
   - Windows（若提示找不到 python）：先安装 Python，或用 Node.js 执行 `npx serve .`
   - 若端口冲突可改成 8081 或 9000，例如 `python3 -m http.server 8081`
2. 浏览器访问
   - 打开 `http://localhost:8080/`
   - 页面会自动跳转到 `src/index.html`
   - 若未跳转，可直接访问 `http://localhost:8080/src/index.html`
3. 修改 data/ 里的 JSON 文件或 images/ 图片
4. 保存后刷新浏览器即可看到变化

## 三、角色维护（data/characters.json）

### 角色字段说明

每个角色是一个对象，放在 characters 数组里，常用字段如下：

- id：角色唯一标识（后续角色专属事件需要用这个 id）
- name：角色名称
- title：角色头衔（可选）
- identity：身份标签（可选）
- monologue：角色独白
- avatar：头像（支持图片路径或 emoji）
- initial_attributes：初始属性（只能使用下面 6 个键）
  - deposit（存款）
  - weight（体重）
  - face（面子）
  - mood（心情）
  - health（健康）
  - luck（运气）

### 新增角色（示例）

```json
{
  "id": "new_role",
  "name": "新角色",
  "title": "角色头衔",
  "identity": "身份标签",
  "monologue": "一句角色独白",
  "avatar": "../images/char-11.png",
  "initial_attributes": {
    "deposit": 3000,
    "weight": 60,
    "face": 20,
    "mood": 70,
    "health": 80,
    "luck": 40
  }
}
```

### 修改角色

- 找到对应 id 的对象，直接改 name/title/monologue/属性等
- avatar 可用图片路径（如 ../images/xxx.png）或 emoji（如 "🧧"）

### 删除角色

- 从 characters 数组删除对应对象
- 同步删除 data/character_events.json 中该角色的专属事件（character_id 与角色 id 一致）
- 如果有用到头像图片，也可从 images/ 删除

## 四、角色专属事件（data/character_events.json）

角色专属事件只会对指定角色生效。核心字段：

- event_id：事件唯一标识
- event_name：事件名称（会影响场景 emoji）
- character_id：必须与 characters.json 里的角色 id 完全一致
- day：第几天触发（1-9），不写则任意天
- time_slot：时段（morning / noon / afternoon / evening / night），不写则任意时段
- description：事件正文
- options：选项数组

每个选项字段：

- option_id：选项唯一标识
- text：选项文字
- effects：属性变化（只支持 deposit/weight/face/mood/health/luck）
- result_desc：结果描述（用于弹窗反馈）

### 新增角色专属事件（示例）

```json
{
  "event_id": "new_role_day1_morning",
  "event_name": "返乡第一天",
  "character_id": "new_role",
  "day": 1,
  "time_slot": "morning",
  "description": "你刚到家，亲戚们就围了上来……",
  "options": [
    {
      "option_id": "new_role_day1_morning_a",
      "text": "主动打招呼",
      "effects": { "face": 5, "mood": 5 },
      "result_desc": "气氛变得融洽起来。"
    },
    {
      "option_id": "new_role_day1_morning_b",
      "text": "装作没看见",
      "effects": { "face": -5, "mood": 2 },
      "result_desc": "亲戚觉得你有点冷淡。"
    }
  ]
}
```

### 修改/删除角色专属事件

- 修改：找到对应 event_id 改内容即可
- 删除：从 events 数组删除该事件对象

## 五、通用事件（data/common_events.json）

通用事件所有角色都会遇到。核心字段：

- event_id：事件唯一标识
- event_name：事件名称
- type：事件类型（可不改）
- trigger_condition：触发条件
  - probability：触发概率（0-1 之间）
  - scene：场景文字，会显示在左侧位置栏
- description：事件正文
- options：选项数组（字段与专属事件一致）

### 新增通用事件（示例）

```json
{
  "event_id": "common_new_year_visit",
  "event_name": "走亲戚",
  "type": "common",
  "trigger_condition": {
    "type": "random",
    "probability": 0.2,
    "scene": "走亲访友的一天"
  },
  "description": "亲戚们热情招待，你有点招架不住。",
  "options": [
    {
      "option_id": "common_new_year_visit_a",
      "text": "陪聊到底",
      "effects": { "mood": -3, "face": 5 },
      "result_desc": "你很累，但面子涨了。"
    }
  ]
}
```

### 修改/删除通用事件

- 修改：直接改 event_id 对应对象
- 删除：从 events 数组删除

## 六、结局维护（data/endings.json）

结局在游戏结束时判定触发。核心字段：

- ending_id：结局唯一标识
- ending_name：结局名称
- description：结局描述
- ending_type：结局类型（success / failure / special / hidden）
- character_id：对应角色 id（与 characters.json 的 id 一致，不写则全角色通用）
- unlockConditions：解锁条件

ending_type 各类型含义：

- success：成功结局（条件达成后给出较正向结果）
- failure：失败结局（条件不足或表现较差时触发）
- special：特殊结局（通常需要特定事件或组合条件）
- hidden：隐藏结局（更苛刻或非直觉条件触发）

unlockConditions 说明：

- unlockConditions 是一个数组，数组里每一项是一个“条件组”
- 条件组里有 conditions 数组，里面的所有条件都要同时满足（AND）
- 只要满足任意一个条件组就能解锁该结局（OR）
- 目前结局判定只支持属性上下限条件（min_/max_）

解锁条件写法（示例结构）：

```json
{
  "min_face": 60,
  "min_mood": 50,
  "max_health": 80
}
```

### 新增结局（示例）

```json
{
  "ending_id": "NEW_ending_success",
  "ending_name": "新年小确幸",
  "description": "你平稳度过春节，收获了简单的快乐。",
  "ending_type": "success",
  "character_id": "new_role",
  "unlockConditions": {
    "min_mood": 60
  }
}
```

### 修改/删除结局

- 修改：找到对应 ending_id 改内容即可
- 删除：从 endings 数组删除

## 七、常见问题

### 1. 事件/角色改了不生效

- JSON 格式有错误会导致加载失败，游戏会回退默认数据
- 使用本地服务器打开页面，避免直接打开 HTML

### 2. 角色专属事件不触发

- 确认 character_id 与 characters.json 的 id 完全一致
- 检查 day/time_slot 是否合理

### 3. 时间段可用值

可用：morning / noon / afternoon / evening / night  
不写则任意时间都可能触发
